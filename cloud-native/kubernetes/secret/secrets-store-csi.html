<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Secrets Store CSI Driver</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/darshandsoni/asciidoctor-skins/css/material-teal.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Secrets Store CSI Driver</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_secrets_store_csi_driver">Secrets Store CSI Driver</a></li>
<li><a href="#_azure_secrets_store_for_key_vault">Azure Secrets store for key vault</a>
<ul class="sectlevel2">
<li><a href="#_aks_setup">AKS setup</a></li>
<li><a href="#_azure_key_vault_provider_for_secrets_store_csi_driver">Azure Key Vault Provider for Secrets Store CSI Driver</a></li>
</ul>
</li>
<li><a href="#_create_secretproviderclass_in_kubernetes">Create <code>SecretProviderClass</code> in Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#_kubernetes_manifest">Kubernetes manifest</a></li>
<li><a href="#_terraform_resource">Terraform resource</a></li>
</ul>
</li>
<li><a href="#_use_the_secretproviderclass_class">Use the <code>SecretProviderClass</code> class</a>
<ul class="sectlevel2">
<li><a href="#_use_as_environment_variable">Use as environment variable</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Secrets Store CSI Driver for Kubernetes secrets - Integrates secrets stores with Kubernetes via a Container Storage Interface (CSI) volume.</p>
</div>
<div class="paragraph">
<p>The Secrets Store CSI Driver secrets-store.csi.k8s.io allows Kubernetes to mount multiple secrets, keys, and certs stored in enterprise-grade external secrets stores into their pods as a volume. Once the Volume is attached, the data in it is mounted into the containerâ€™s file system.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">References</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://secrets-store-csi-driver.sigs.k8s.io" class="bare">https://secrets-store-csi-driver.sigs.k8s.io</a></p>
</li>
<li>
<p><a href="https://azure.github.io/secrets-store-csi-driver-provider-azure/" class="bare">https://azure.github.io/secrets-store-csi-driver-provider-azure/</a></p>
</li>
<li>
<p><a href="https://github.com/hashicorp/vault-csi-provider" class="bare">https://github.com/hashicorp/vault-csi-provider</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secrets_store_csi_driver">Secrets Store CSI Driver</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://secrets-store-csi-driver.sigs.k8s.io/getting-started/usage.html">Usage</a></p>
</li>
<li>
<p><a href="https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret.html">Sync as Kubernetes Secret</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_azure_secrets_store_for_key_vault">Azure Secrets store for key vault</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_aks_setup">AKS setup</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver">Use the Azure Key Vault Provider for Secrets Store CSI Driver in an AKS cluster</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-identity-access">Provide an identity to access the Azure Key Vault Provider for Secrets Store CSI Driver</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_azure_key_vault_provider_for_secrets_store_csi_driver">Azure Key Vault Provider for Secrets Store CSI Driver</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/getting-started/usage/">Using the Azure Key Vault Provider</a></p>
</li>
<li>
<p><a href="https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/configurations/">Configurations</a></p>
</li>
<li>
<p><a href="https://azure.github.io/secrets-store-csi-driver-provider-azure/docs/configurations/sync-with-k8s-secrets/">Sync Mounted Content with Kubernetes Secret</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_secretproviderclass_in_kubernetes">Create <code>SecretProviderClass</code> in Kubernetes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kubernetes_manifest">Kubernetes manifest</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: app-credentials
spec:
  provider: azure
  secretObjects: # [OPTIONAL] SecretObject defines the desired state of synced K8s secret objects
    - secretName: foosecret
      type: Opaque
      labels:
        environment: "test"
      data:
        - objectName: taClientSecret                    # name of the mounted content to sync. this could be the object name or object alias
          key: taSecret
  parameters:
    useVMManagedIdentity: "true"
    userAssignedIdentityID: 281560cf-6725-4760-b34d-19819ec62b9f
    keyvaultName: kv-app-platform
    objects:  |
      array:
        - |
          objectName: ta-ClientSecret
          objectAlias: taClientSecret
          objectType: secret
        - |
          objectName: shared-storageAccountAccessKey
          objectType: secret
    tenantId: &lt;your-tenant-id&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terraform_resource">Terraform resource</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-hcl-terraform" data-lang="hcl-terraform">resource "kubernetes_manifest" "spc_app_credentials" {
  manifest = {
    "apiVersion" = "secrets-store.csi.x-k8s.io/v1"
    "kind"       = "SecretProviderClass"
    "metadata"   = {
      "name"      = "app-credentials"
      "namespace" = kubernetes_namespace.app_platform.metadata[0].name
    }
    spec = {
      provider      = "azure"
      secretObjects = [
        {
          secretName = "kv-app-credentials"
          type       = "Opaque"
          labels     = {
            "app.kubernetes.io/created-by" = "terraform"
            "app.kubernetes.io/part-of"    = "app-platform"
            "app.kubernetes.io/component"  = "configuration"
          }
          data = [
            {
              objectName = "taClientSecret"
              key        = "taSecret"
            }
          ]
        }
      ]
      parameters = {
        tenantId               = data.azurerm_client_config.current.tenant_id
        useVMManagedIdentity   = "true"
        userAssignedIdentityID = data.azurerm_user_assigned_identity.keyvault_secrets_provider.client_id
        keyvaultName           = data.azurerm_key_vault.app_platform.name
        objects                = &lt;&lt;-EOF
        array:
          - |
            objectName: ta-ClientSecret
            objectAlias: taClientSecret
            objectType: secret
          - |
            objectName: shared-storageAccountAccessKey
            objectType: secret
        EOF
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_the_secretproviderclass_class">Use the <code>SecretProviderClass</code> class</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_use_as_environment_variable">Use as environment variable</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx-csi
  name: nginx-csi
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx-csi
  strategy: {}
  template:
    metadata:
      labels:
        app: nginx-csi
    spec:
      containers:
      - image: nginx
        name: nginx
        env:
          - name: AZURE_CLIENT_SECRET
            valueFrom:
              secretKeyRef:
                name: foosecret
                key: taSecret

        volumeMounts:
        - name: secrets-store-inline
          mountPath: "/mnt/secrets-store"
          readOnly: true
        resources:
          requests:
            memory: 100Mi
            cpu: 200m
          limits:
            memory: 150Mi
            cpu: 1
      volumes:
        - name: secrets-store-inline
          csi:
            driver: secrets-store.csi.k8s.io
            readOnly: true
            volumeAttributes:
              secretProviderClass: "app-credentials"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-22 13:10:08 UTC
</div>
</div>
</body>
</html>