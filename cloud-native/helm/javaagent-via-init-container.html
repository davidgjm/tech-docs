<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Setting observability Java agent via init container</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/darshandsoni/asciidoctor-skins/css/material-teal.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Setting observability Java agent via init container</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_setup_emptydir_volume">Setup <code>emptyDir</code> volume</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_setup_emptydir_volume">Setup <code>emptyDir</code> volume</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: online-shopping
  labels:
    app.kubernetes.io/name: online-shopping
  annotations:
    rollme: "fB47B"
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: online-shopping
  template:
    metadata:
      labels:
        app.kubernetes.io/name: online-shopping
    spec:
      serviceAccountName: online-shopping
      initContainers:
        - name: otel
          image: busybox:1.35
          env:
            - name: OTEL_AGENT_VERSION
              value: 1.14.0
          command: [ "/bin/sh", "-c" ]
          args:
            - &gt;-
              DEST_DIR=/data/observability/agent;
              AGENT_VER=v$(OTEL_AGENT_VERSION);
              AGENT_FILE=opentelemetry-javaagent.jar;
              mkdir -p ${DEST_DIR};
              if [ ! -f ${DEST_DIR}/${AGENT_FILE} ];
              then wget --no-check-certificate -P ${DEST_DIR} https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/download/${AGENT_VER}/${AGENT_FILE};
              fi
          volumeMounts:
            - name: observability-agent
              mountPath: /data/observability/agent
      containers:
        - name: app
          image: online-shopping:latest
          imagePullPolicy: Always
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: "dev"
            - name: SPRING_CLOUD_BOOTSTRAP_LOCATION
              value: /etc/config/bootstrap/
            - name: JAVA_TOOL_OPTIONS
              value: -javaagent:/data/observability/agent/opentelemetry-javaagent.jar
          volumeMounts:
            - name: config-bootstrap
              mountPath: /etc/config/bootstrap
              readOnly: true
            - name: observability-agent
              mountPath: /data/observability/agent
            - name: observability-config
              mountPath: /data/observability/config
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /actuator/health/liveness
              port: http
            failureThreshold: 10
          readinessProbe:
            httpGet:
              path: /actuator/health/readiness
              port: http
            failureThreshold: 10
          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 300m
              memory: 1Gi
      volumes:
        - name: config-bootstrap
          configMap:
            name: online-shopping-bootstrap
            optional: false
        - name: observability-agent
          emptyDir: { }
        - name: observability-config
          configMap:
            name: observability
            items:
              - key: otel.json
                path: otel.json</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-22 13:10:08 UTC
</div>
</div>
</body>
</html>