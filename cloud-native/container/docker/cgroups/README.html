<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>cgroups with docker</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/darshandsoni/asciidoctor-skins/css/material-teal.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>cgroups with docker</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_limiting_cpu_cgroups_v2">Limiting cpu (cgroups v2)</a>
<ul class="sectlevel2">
<li><a href="#_run_a_docker_container">Run a docker container</a></li>
<li><a href="#_check_pstree">Check <code>pstree</code></a></li>
<li><a href="#_check_the_pid_in_cgroup_procs">Check the PID in <code>cgroup.procs</code></a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_limiting_cpu_cgroups_v2">Limiting cpu (cgroups v2)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_run_a_docker_container">Run a docker container</h3>
<div class="literalblock">
<div class="content">
<pre>ubuntu@linuxbox:~$ docker run -it --cpu-period=100000 --cpu-quota=20000 nginx /bin/bash
root@28b59d5db245:/#</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ubuntu@linuxbox:~$ docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES
28b59d5db245   nginx     "/docker-entrypoint.…"   10 minutes ago   Up 10 minutes   80/tcp    interesting_mccarthy</pre>
</div>
</div>
<div class="paragraph">
<p>Note the container id <em>28b59d5db245</em> above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_check_pstree">Check <code>pstree</code></h3>
<div class="paragraph">
<p>The PID <em>7192</em> is the process id for the docker container created above</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ubuntu@linuxbox:~$ pstree -p
systemd(1)─┬─agetty(655)
├─agetty(661)
├─containerd(649)─┬─{containerd}(702)
│                 ├─{containerd}(703)
│                 ├─{containerd}(704)
│                 ├─{containerd}(705)
│                 ├─{containerd}(706)
│                 ├─{containerd}(720)
│                 ├─{containerd}(722)
│                 ├─{containerd}(1501)
│                 └─{containerd}(2440)
├─containerd-shim(7169)─┬─bash(7192)
│                       ├─{containerd-shim}(7170)
│                       ├─{containerd-shim}(7171)
│                       ├─{containerd-shim}(7172)
│                       ├─{containerd-shim}(7173)
│                       ├─{containerd-shim}(7174)
│                       ├─{containerd-shim}(7175)
│                       ├─{containerd-shim}(7176)
│                       ├─{containerd-shim}(7177)
│                       └─{containerd-shim}(7218)
├─cron(623)
├─dbus-daemon(624)
├─dockerd(3583)─┬─{dockerd}(3585)
│               ├─{dockerd}(3586)
│               ├─{dockerd}(3587)
│               ├─{dockerd}(3588)
│               ├─{dockerd}(3589)
│               ├─{dockerd}(3590)
│               ├─{dockerd}(3591)
│               ├─{dockerd}(3592)
│               ├─{dockerd}(3593)
│               ├─{dockerd}(3594)
│               └─{dockerd}(3595)
├─fwupd(6034)─┬─{fwupd}(6055)
│             ├─{fwupd}(6061)
│             ├─{fwupd}(6062)
│             └─{fwupd}(6064)
├─irqbalance(630)───{irqbalance}(656)
├─multipathd(494)─┬─{multipathd}(495)
│                 ├─{multipathd}(496)
│                 ├─{multipathd}(497)
│                 ├─{multipathd}(498)
│                 ├─{multipathd}(499)
│                 └─{multipathd}(500)
├─networkd-dispat(632)
├─packagekitd(1434)─┬─{packagekitd}(1435)
│                   └─{packagekitd}(1436)
├─polkitd(693)─┬─{polkitd}(694)
│              └─{polkitd}(696)
├─rsyslogd(633)─┬─{rsyslogd}(663)
│               ├─{rsyslogd}(664)
│               └─{rsyslogd}(665)
├─snapd(5183)─┬─{snapd}(5194)
│             ├─{snapd}(5195)
│             ├─{snapd}(5196)
│             ├─{snapd}(5197)
│             ├─{snapd}(5198)
│             ├─{snapd}(5204)
│             ├─{snapd}(5206)
│             ├─{snapd}(5209)
│             ├─{snapd}(5210)
│             ├─{snapd}(5258)
│             └─{snapd}(5270)
├─sshd(689)─┬─sshd(6102)───sshd(6210)───bash(6211)───docker(7137)─┬─{docker}(7138)
│           │                                                     ├─{docker}(7139)
│           │                                                     ├─{docker}(7140)
│           │                                                     ├─{docker}(7141)
│           │                                                     ├─{docker}(7142)
│           │                                                     ├─{docker}(7143)
│           │                                                     ├─{docker}(7145)
│           │                                                     ├─{docker}(7146)
│           │                                                     └─{docker}(7147)
│           ├─sshd(6398)───sshd(6469)───bash(6470)───pstree(7227)
│           └─sshd(6615)───sshd(6686)───bash(6687)───sudo(6696)───su(6697)───bash(6698)───bash(7019)
├─systemd(6105)───(sd-pam)(6106)
├─systemd-journal(368)
├─systemd-logind(641)
├─systemd-network(584)
├─systemd-resolve(586)
├─systemd-timesyn(536)───{systemd-timesyn}(541)
├─systemd-udevd(400)
├─udisksd(644)─┬─{udisksd}(678)
│              ├─{udisksd}(687)
│              ├─{udisksd}(698)
│              └─{udisksd}(715)
└─unattended-upgr(688)───{unattended-upgr}(718)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_the_pid_in_cgroup_procs">Check the PID in <code>cgroup.procs</code></h3>
<div class="paragraph">
<p>The directory <strong><em>docker-28b59d5db245184419afeb09d9756c666979a46f6a7d5cc0e87f2502c92714ec.scope</em></strong> is the cgroupfs directory for the subject container.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>root@linuxbox:~# cd /sys/fs/cgroup/system.slice</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@linuxbox:/sys/fs/cgroup/system.slice# ll
total 0
drwxr-xr-x 88 root root 0 Dec 21 23:24  .
dr-xr-xr-x 14 root root 0 Dec 21 22:22  ..
drwxr-xr-x  2 root root 0 Dec 19 18:05  apparmor.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  apport.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  blk-availability.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  boot-efi.mount
-r--r--r--  1 root root 0 Dec 19 17:32  cgroup.controllers
-r--r--r--  1 root root 0 Dec 19 17:32  cgroup.events
-rw-r--r--  1 root root 0 Dec 19 17:32  cgroup.freeze
-rw-r--r--  1 root root 0 Dec 19 17:32  cgroup.max.depth
-rw-r--r--  1 root root 0 Dec 19 17:32  cgroup.max.descendants
-rw-r--r--  1 root root 0 Dec 19 17:32  cgroup.procs
-r--r--r--  1 root root 0 Dec 19 17:32  cgroup.stat
-rw-r--r--  1 root root 0 Dec 21 10:13  cgroup.subtree_control
-rw-r--r--  1 root root 0 Dec 19 17:32  cgroup.threads
-rw-r--r--  1 root root 0 Dec 19 17:32  cgroup.type
drwxr-xr-x  2 root root 0 Dec 19 18:05  cloud-config.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  cloud-final.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  cloud-init-hotplugd.socket
drwxr-xr-x  2 root root 0 Dec 19 18:05  cloud-init-local.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  cloud-init.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  console-setup.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  containerd.service
-rw-r--r--  1 root root 0 Dec 19 17:32  cpu.max
-rw-r--r--  1 root root 0 Dec 19 17:32  cpu.pressure
-r--r--r--  1 root root 0 Dec 19 17:32  cpu.stat
-rw-r--r--  1 root root 0 Dec 19 17:32  cpu.uclamp.max
-rw-r--r--  1 root root 0 Dec 19 17:32  cpu.uclamp.min
-rw-r--r--  1 root root 0 Dec 19 17:32  cpu.weight
-rw-r--r--  1 root root 0 Dec 19 17:32  cpu.weight.nice
-rw-r--r--  1 root root 0 Dec 19 17:32  cpuset.cpus
-r--r--r--  1 root root 0 Dec 19 17:32  cpuset.cpus.effective
-rw-r--r--  1 root root 0 Dec 19 17:32  cpuset.cpus.partition
-rw-r--r--  1 root root 0 Dec 19 17:32  cpuset.mems
-r--r--r--  1 root root 0 Dec 19 17:32  cpuset.mems.effective
drwxr-xr-x  2 root root 0 Dec 19 18:05  cron.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  dbus.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  dbus.socket
drwxr-xr-x  2 root root 0 Dec 19 18:05  dm-event.socket
drwxr-xr-x  2 root root 0 Dec 21 23:14  docker-28b59d5db245184419afeb09d9756c666979a46f6a7d5cc0e87f2502c92714ec.scope
drwxr-xr-x  2 root root 0 Dec 19 22:35  docker.service
drwxr-xr-x  2 root root 0 Dec 19 18:05  docker.socket</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_find_whats_included_under_the_container_scope">Find what&#8217;s included under the container scope</h4>
<div class="literalblock">
<div class="content">
<pre>root@linuxbox:/sys/fs/cgroup/system.slice# cd docker-28b59d5db245184419afeb09d9756c666979a46f6a7d5cc0e87f2502c92714ec.scope
root@linuxbox:/sys/fs/cgroup/system.slice/docker-28b59d5db245184419afeb09d9756c666979a46f6a7d5cc0e87f2502c92714ec.scope# ll
total 0
drwxr-xr-x  2 root root 0 Dec 21 23:14 .
drwxr-xr-x 88 root root 0 Dec 21 23:24 ..
-r--r--r--  1 root root 0 Dec 21 23:14 cgroup.controllers
-r--r--r--  1 root root 0 Dec 21 23:14 cgroup.events
-rw-r--r--  1 root root 0 Dec 21 23:14 cgroup.freeze
-rw-r--r--  1 root root 0 Dec 21 23:17 cgroup.max.depth
-rw-r--r--  1 root root 0 Dec 21 23:17 cgroup.max.descendants
-rw-r--r--  1 root root 0 Dec 21 23:14 cgroup.procs
-r--r--r--  1 root root 0 Dec 21 23:17 cgroup.stat
-rw-r--r--  1 root root 0 Dec 21 23:14 cgroup.subtree_control
-rw-r--r--  1 root root 0 Dec 21 23:17 cgroup.threads
-rw-r--r--  1 root root 0 Dec 21 23:14 cgroup.type
-rw-r--r--  1 root root 0 Dec 21 23:14 cpu.max
-rw-r--r--  1 root root 0 Dec 21 23:17 cpu.pressure
-r--r--r--  1 root root 0 Dec 21 23:14 cpu.stat
-rw-r--r--  1 root root 0 Dec 21 23:17 cpu.uclamp.max
-rw-r--r--  1 root root 0 Dec 21 23:17 cpu.uclamp.min
-rw-r--r--  1 root root 0 Dec 21 23:14 cpu.weight
-rw-r--r--  1 root root 0 Dec 21 23:17 cpu.weight.nice
-rw-r--r--  1 root root 0 Dec 21 23:14 cpuset.cpus
-r--r--r--  1 root root 0 Dec 21 23:17 cpuset.cpus.effective
-rw-r--r--  1 root root 0 Dec 21 23:17 cpuset.cpus.partition
-rw-r--r--  1 root root 0 Dec 21 23:14 cpuset.mems
-r--r--r--  1 root root 0 Dec 21 23:17 cpuset.mems.effective
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.1GB.current
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.1GB.events
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.1GB.events.local
-rw-r--r--  1 root root 0 Dec 21 23:17 hugetlb.1GB.max
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.1GB.rsvd.current
-rw-r--r--  1 root root 0 Dec 21 23:17 hugetlb.1GB.rsvd.max
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.2MB.current
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.2MB.events
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.2MB.events.local
-rw-r--r--  1 root root 0 Dec 21 23:17 hugetlb.2MB.max
-r--r--r--  1 root root 0 Dec 21 23:17 hugetlb.2MB.rsvd.current
-rw-r--r--  1 root root 0 Dec 21 23:17 hugetlb.2MB.rsvd.max
-rw-r--r--  1 root root 0 Dec 21 23:17 io.max
-rw-r--r--  1 root root 0 Dec 21 23:17 io.pressure
-r--r--r--  1 root root 0 Dec 21 23:14 io.stat
-rw-r--r--  1 root root 0 Dec 21 23:14 io.weight
-r--r--r--  1 root root 0 Dec 21 23:17 memory.current
-r--r--r--  1 root root 0 Dec 21 23:14 memory.events
-r--r--r--  1 root root 0 Dec 21 23:17 memory.events.local
-rw-r--r--  1 root root 0 Dec 21 23:14 memory.high
-rw-r--r--  1 root root 0 Dec 21 23:14 memory.low
-rw-r--r--  1 root root 0 Dec 21 23:14 memory.max
-rw-r--r--  1 root root 0 Dec 21 23:14 memory.min
-r--r--r--  1 root root 0 Dec 21 23:17 memory.numa_stat
-rw-r--r--  1 root root 0 Dec 21 23:14 memory.oom.group
-rw-r--r--  1 root root 0 Dec 21 23:17 memory.pressure
-r--r--r--  1 root root 0 Dec 21 23:17 memory.stat
-r--r--r--  1 root root 0 Dec 21 23:17 memory.swap.current
-r--r--r--  1 root root 0 Dec 21 23:17 memory.swap.events
-rw-r--r--  1 root root 0 Dec 21 23:17 memory.swap.high
-rw-r--r--  1 root root 0 Dec 21 23:14 memory.swap.max
-r--r--r--  1 root root 0 Dec 21 23:17 misc.current
-rw-r--r--  1 root root 0 Dec 21 23:17 misc.max
-r--r--r--  1 root root 0 Dec 21 23:17 pids.current
-r--r--r--  1 root root 0 Dec 21 23:17 pids.events
-rw-r--r--  1 root root 0 Dec 21 23:14 pids.max
-r--r--r--  1 root root 0 Dec 21 23:17 rdma.current
-rw-r--r--  1 root root 0 Dec 21 23:17 rdma.max</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_the_pid_7192">Check the PID 7192</h4>
<div class="literalblock">
<div class="content">
<pre>root@linuxbox:/sys/fs/cgroup/system.slice/docker-28b59d5db245184419afeb09d9756c666979a46f6a7d5cc0e87f2502c92714ec.scope# cat cgroup.procs
7192</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-22 13:10:08 UTC
</div>
</div>
</body>
</html>