<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Architectural approaches for the deployment and configuration of multitenant solutions</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/darshandsoni/asciidoctor-skins/css/material-teal.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Architectural approaches for the deployment and configuration of multitenant solutions</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_key_considerations_and_requirements">Key considerations and requirements</a>
<ul class="sectlevel2">
<li><a href="#_onboarding_and_provisioning_steps">Onboarding and provisioning steps</a></li>
<li><a href="#_automation">Automation</a></li>
<li><a href="#_maximum_resource_capacity">Maximum resource capacity</a></li>
<li><a href="#_resource_management_responsibility">Resource management responsibility</a></li>
<li><a href="#_testing">Testing</a></li>
</ul>
</li>
<li><a href="#_approaches_and_patterns_to_consider">Approaches and patterns to consider</a>
<ul class="sectlevel2">
<li><a href="#_deployment_stamps_pattern">Deployment Stamps pattern</a></li>
<li><a href="#_deployment_rings">Deployment rings</a></li>
<li><a href="#_feature_flags">Feature flags</a></li>
</ul>
</li>
<li><a href="#_antipatterns_to_avoid">Antipatterns to avoid</a></li>
<li><a href="#_tenant_lists_as_configuration_or_data">Tenant lists as configuration or data</a>
<ul class="sectlevel2">
<li><a href="#_tenant_list_as_a_configuration">Tenant list as a configuration</a></li>
<li><a href="#_tenant_list_as_data">Tenant list as data</a></li>
<li><a href="#_example">Example</a></li>
</ul>
</li>
<li><a href="#_next_steps">Next steps</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Regardless of your architecture and the components you use to implement it, you need to deploy and configure your solution&#8217;s components. In a multitenant environment, it&#8217;s important to consider how you deploy your Azure resources, especially when you deploy dedicated resources for each tenant, or when you reconfigure resources based on the number of tenants in your system. On this page, we provide solution architects with guidance about deploying multitenant solutions, and we demonstrate some approaches to consider when you plan your deployment strategy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_considerations_and_requirements">Key considerations and requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s important to have a clear idea of your requirements, before you plan your deployment strategy. Specific considerations include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Expected scale</strong>: Do you expect to support a small number of tenants (such as five or less), or will you grow to a large number of tenants?</p>
</li>
<li>
<p><strong>Automated or supported onboarding</strong>: When a tenant is ready to be onboarded, will they be able to complete the process themselves by following an automated procedure? Or, do new tenants initiate a request, and you manually onboard them after you receive the request? Are there manual approval steps required from your team, such as to prevent the abuse of your service?</p>
</li>
<li>
<p><strong>Provisioning time</strong>: When a tenant is ready to be onboarded, how quickly does the onboarding process need to be completed? If you don&#8217;t have a clear answer, consider whether this should be measured in seconds, minutes, hours, or days.</p>
</li>
<li>
<p><strong>Azure Marketplace</strong>: Do you plan to use the Azure Marketplace to initiate the deployment? If you do, there are <a href="https://docs.microsoft.com/en-us/azure/marketplace/plan-azure-application-offer">requirements that you need to meet to add new tenants</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should also consider onboarding and provisioning steps, automation, and resource management responsibility.</p>
</div>
<div class="sect2">
<h3 id="_onboarding_and_provisioning_steps">Onboarding and provisioning steps</h3>
<div class="paragraph">
<p>Consider everything that you need to do when onboarding a tenant, and document this list and workflow, even if it&#8217;s performed manually. The onboarding workflow typically includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Acceptance of commercial agreements.</p>
</li>
<li>
<p>Collection of the information that you need to configure your system for the new tenant.</p>
</li>
<li>
<p>Manual approval steps, for example, to prevent fraud or abuse of your service.</p>
</li>
<li>
<p>The provisioning of resources in Azure.</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/architecture/guide/multitenant/considerations/domain-names">Creating or configuring domain names</a>.</p>
</li>
<li>
<p>Perform post-deployment configuration tasks, such as creating the first user account for the tenant and securely transmit its credentials.</p>
</li>
<li>
<p>Manual configuration changes, such as DNS record changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clearly document the workflow that&#8217;s required to onboard a new tenant.</p>
</div>
<div class="paragraph">
<p>Additionally, consider the specific Azure resources that you need to provision for a tenant. Even if you don&#8217;t provision dedicated resources for each tenant, consider whether you sometimes need to deploy resources when a new tenant is onboarded. This might occur when a tenant requires their data to be stored in a specific region, or when you approach the limits of a stamp or component in your solution and need to create another instance for the next batch of tenants.</p>
</div>
<div class="paragraph">
<p>Consider whether the onboarding process is likely to be disruptive to other tenants, especially to those who share the same infrastructure. For example, if you need to modify shared databases, could this process cause a performance impact that other tenants might notice? Consider whether you can avoid these effects, or mitigate them by performing the onboarding process outside of normal operating hours.</p>
</div>
</div>
<div class="sect2">
<h3 id="_automation">Automation</h3>
<div class="paragraph">
<p>Automated deployments are always advisable for cloud-hosted solutions. When working with multitenant solutions, deployment automation becomes even more important for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scale</strong>: An automated deployment approach scales, as the number of tenants grows. Manual deployment processes become increasingly complex and time-consuming, as your tenant population increases.</p>
</li>
<li>
<p><strong>Repeatable</strong>: In a multitenant environment, use a consistent process for deployments across all tenants. Manual processes introduce the chance of error, or of steps being performed for some tenants and not others. These manual processes leave your environment in an inconsistent state.</p>
</li>
<li>
<p><strong>Impact of outages</strong>: Manual deployments are significantly more risky and prone to outages than automated deployments. In a multitenant environment, the impact of a system-wide outage (due to a deployment error) can be high, since every tenant could be affected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you deploy to a multitenant environment, you should use deployment pipelines, and use infrastructure as code (IaC) technologies, such as Bicep, JSON ARM templates, Terraform, or the Azure SDKs.</p>
</div>
<div class="paragraph">
<p>If you plan to offer your solution through the Azure Marketplace, you should provide a fully automated onboarding process for new tenants. This process is described in the <a href="https://docs.microsoft.com/en-us/azure/marketplace/partner-center-portal/pc-saas-fulfillment-operations-api">SaaS fulfillment APIs documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maximum_resource_capacity">Maximum resource capacity</h3>
<div class="paragraph">
<p>When you programmatically deploy tenant resources onto shared resources, consider the capacity limit for each resource. When you approach that limit, you might need to create another instance of the resource to support further scale. Consider the limits of each resource that you deploy, and the conditions that will trigger you to deploy another instance.</p>
</div>
<div class="paragraph">
<p>For example, suppose your solution includes an Azure SQL logical server, and your solution provisions a dedicated database on that server for each tenant. A <a href="https://docs.microsoft.com/en-us/azure/azure-sql/database/resource-limits-logical-server#logical-server-limits">single logical server has limits</a>, which include a maximum number of databases that a logical server supports. As you approach these limits, you might need to provision new servers so that you can continue to onboard tenants. Consider whether you automate this process or manually monitor the growth.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_management_responsibility">Resource management responsibility</h3>
<div class="paragraph">
<p>In some multitenant solutions, you deploy dedicated Azure resources for each tenant, such as a database for each tenant. Or, you might decide on a set number of tenants to house on a single instance of a resource, so the number of tenants you have dictates the set of resources that you deploy to Azure. In other solutions, you deploy a single set of shared resources, and you then reconfigure the resources when you onboard new tenants.</p>
</div>
<div class="paragraph">
<p>Each of these models requires you to deploy and manage resources in different ways, and you must consider how you will deploy and manage the lifecycle of the resources that you provision. Two common approaches are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To treat tenants as <em>configuration</em> of the resources that you deploy, and use your deployment pipelines to deploy and configure those resources.</p>
</li>
<li>
<p>To treat tenants as <em>data</em>, and have your application tier provision and configure infrastructure for your tenants.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further discussion of these approaches is provided below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing">Testing</h3>
<div class="paragraph">
<p>Plan to thoroughly test your solution during and after every deployment. Automated testing can be used to verify the functional and non-functional behavior of your solution. Ensure you test your tenant isolation model, and consider using tools like <a href="https://docs.microsoft.com/en-us/azure/chaos-studio/chaos-studio-overview">Azure Chaos Studio</a> to deliberately introduce faults that simulate real-world outages and verify that your solution functions even when a component is unavailable or malfunctioning.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_approaches_and_patterns_to_consider">Approaches and patterns to consider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several design patterns from the Azure Architecture Center, and the wider community, are of relevance to the deployment and configuration of multitenant solutions.</p>
</div>
<div class="sect2">
<h3 id="_deployment_stamps_pattern">Deployment Stamps pattern</h3>
<div class="paragraph">
<p>The <a href="../../../../design-patterns/deployment-stamp.html">Deployment Stamps pattern</a> involves deploying dedicated infrastructure for a tenant or group of tenants. A single stamp might contain multiple tenants, or it might be dedicated to a single tenant. You can choose to deploy a single stamp, or you can coordinate a deployment across multiple stamps. If you deploy dedicated stamps for each tenant, you can also consider deploying entire stamps programmatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_rings">Deployment rings</h3>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/azure/devops/migrate/phase-rollout-with-rings">Deployment rings</a> enable you to roll out updates to different groups of infrastructure at different times.This approach is commonly used with the <a href="../../../../design-patterns/deployment-stamp.html">Deployment Stamps pattern</a>, and groups of stamps are deployed into distinct rings based on tenant preferences, workload types, and other considerations.For more information, see <a href="../considerations/updates.html#_deployment_rings">Deployment rings</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feature_flags">Feature flags</h3>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/devops/operate/progressive-experimentation-feature-flags">Feature flags</a> enable you to expose new features or versions of your solution to different tenants, while you maintain a single codebase.Consider using Azure App Configuration to manage your feature flags.For more information, see <a href="../considerations/updates.html#_feature_flags">Feature flags</a>.</p>
</div>
<div class="paragraph">
<p>Sometimes you need to selectively enable specific features for certain customers.For example, you might have different <a href="../considerations/pricing-models.html">pricing tiers</a> that allow access to certain capabilities.Feature flags aren&#8217;t usually the right choice for these scenarios.Instead, consider building a process to track and enforce the <em>license entitlements</em> that each customer has.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_antipatterns_to_avoid">Antipatterns to avoid</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you deploy and configure multitenant solutions, it&#8217;s important to avoid situations that inhibit your ability to scale. These include the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Manual deployment and testing.</dt>
<dd>
<p>As described above, manual deployment processes add risk and slow your ability to deploy. Consider using automated deployments using pipelines, the programmatic creation of resources from your solution&#8217;s code, or a combination of both.</p>
</dd>
<dt class="hdlist1">Ad hoc customizations for tenants.</dt>
<dd>
<p>Avoid deploying features or a configuration that only applies to a single tenant. This approach adds complexity to your deployments and testing processes. Instead, use the same resource types and codebase for each tenant, and use strategies like <a href="#_feature_flags">feature flags</a> for temporary changes or for features that are rolled out progressively, or use different <a href="../considerations/pricing-models.html">pricing tiers</a> with license entitlements to selectively enable features for tenants that require them. Use a consistent and automated deployment process, even for tenants that have isolated or dedicated resources.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tenant_lists_as_configuration_or_data">Tenant lists as configuration or data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can consider the following two approaches when you deploy resources in a multitenant solution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Use an automated deployment pipeline to deploy every resource.</strong> As new tenants are added, reconfigure your pipeline to provision the resources for each tenant.</p>
</li>
<li>
<p><strong>Use an automated deployment pipeline to deploy shared resources that don&#8217;t depend on the number of tenants.</strong> For resources that are deployed for each tenant, create them within your application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When considering the two approaches, you should distinguish between treating your tenant list as a <em>configuration</em> or as <em>data</em>.</p>
</div>
<div class="sect2">
<h3 id="_tenant_list_as_a_configuration">Tenant list as a configuration</h3>
<div class="paragraph">
<p>When you treat your tenant list as a configuration, you deploy all your resources from your deployment pipeline. When new tenants are onboarded, you reconfigure the pipeline or its parameters. Typically, the reconfiguration happens through manual changes, as illustrated in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/tenants-configuration.png" alt="Diagram showing the process of onboarding a tenant when the tenant list is maintained as a pipeline configuration.">
</div>
</div>
<div class="paragraph">
<p>The process to onboard a new tenant might be similar to the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the tenant list. This typically happens manually by configuring the pipeline itself, or by modifying a parameters file that&#8217;s included in the pipeline&#8217;s configuration.</p>
</li>
<li>
<p>Trigger the pipeline to run.</p>
</li>
<li>
<p>The pipeline redeploys your complete set of Azure resources, including any new tenant-specific resources.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This approach tends to work well for small numbers of tenants, and for architectures where all resources are shared. It&#8217;s a simple approach because all of your Azure resources can be deployed and configured by using a single process.</p>
</div>
<div class="paragraph">
<p>However, when you approach a larger number of tenants, say 5 to 10 or more, it becomes cumbersome to reconfigure the pipeline as you add tenants. The time it takes to run the deployment pipeline often increases significantly too. This approach also doesn&#8217;t easily support self-service tenant creation, and the lead time before a tenant is onboarded can be longer because you need to trigger your pipeline to run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tenant_list_as_data">Tenant list as data</h3>
<div class="paragraph">
<p>When you treat your tenant list as data, you still deploy your shared components by using a pipeline. However, for resources and configuration settings that need to be deployed for each tenant, you imperatively deploy or configure your resources. For example, you can use the <a href="https://azure.microsoft.com/downloads">Azure SDKs</a> to create a specific resource or to initiate the deployment of a parameterized template.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/tenants-data.png" alt="tenants data">
</div>
</div>
<div class="paragraph">
<p>The process to onboard a new tenant might be similar to the following, and would happen asynchronously:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Request a tenant be onboarded, such as by initiating an API request.</p>
</li>
<li>
<p>A workflow component receives the creation request and orchestrates the remaining steps.</p>
</li>
<li>
<p>The workflow initiates the deployment of tenant-specific resources to Azure. This could be achieved by using an imperative programming model, such as by using the Azure SDKs, or by imperatively triggering the deployment of a Bicep or Terraform template.</p>
</li>
<li>
<p>When the deployment is completed, the workflow saves the new tenant&#8217;s details to the central tenant database. The data stored for each tenant might include the tenant ID and the resource IDs for all of the tenant-specific resources that the workflow created.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By doing this, you can provision resources for new tenants without redeploying your entire solution. The time involved in provisioning new resources for each tenant is likely to be shorter, because only those resources need to be deployed.</p>
</div>
<div class="paragraph">
<p>However, this approach is often much more time-consuming to build, and the effort you spend needs to be justified by the number of tenants or the provisioning timeframes you need to meet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Azure deployment and configuration operations often take time to complete. Ensure you use an appropriate process to initiate and monitor these long-running operations. For example, you might consider following the <a href="../../../../design-patterns/async-request-reply.html">Asynchronous Request-Reply pattern</a>. Use technologies that are designed to support long-running operations, like <a href="https://azure.microsoft.com/services/logic-apps/">Azure Logic Apps</a> and <a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview">Durable Functions</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_example">Example</h3>
<div class="paragraph">
<p>Contoso runs a multitenant solution for their customers. Currently, they have six tenants, and they expect to grow to 300 tenants within the next 18 months. Contoso follows the <a href="storage-data.html#_multitenant_app_with_dedicated_databases_for_each_tenant">Multitenant app with dedicated databases for each tenant</a> approach. They have deployed a single set of App Service resources and an Azure SQL logical server that are shared between all of their tenants, and they deploy a dedicated Azure SQL database for each tenant, as shown in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/example-architecture.png" alt="example architecture">
</div>
</div>
<div class="paragraph">
<p>Contoso uses Bicep to deploy their Azure resources.</p>
</div>
<div class="sect3">
<h4 id="_option_1_use_deployment_pipelines_for_everything">Option 1 - Use deployment pipelines for everything</h4>
<div class="paragraph">
<p>Contoso might consider deploying all of their resources by using a deployment pipeline. Their pipeline deploys a Bicep file that includes all of their Azure resources, including the Azure SQL databases for each tenant. A parameter file defines the list of tenants, and the Bicep file uses a <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/loop-resources">resource loop</a> to deploy a database for each of the listed tenants, as shown in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/example-configuration.png" alt="example configuration">
</div>
</div>
<div class="paragraph">
<p>If Contoso follows this model, then they need to update their parameter file as part of the onboarding of a new tenant. Then they need to re-run their pipeline. Also, they need to manually keep track of whether they are near any limits, such as if they grow at an unexpectedly high rate and approach the maximum number of databases that are supported on a single Azure SQL logical server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_option_2_use_a_combination_of_deployment_pipelines_and_imperative_resource_creation">Option 2 - Use a combination of deployment pipelines and imperative resource creation</h4>
<div class="paragraph">
<p>Alternatively, Contoso might consider separating the responsibility for the Azure deployments.</p>
</div>
<div class="paragraph">
<p>Contoso uses a Bicep file that defines the shared resources that should be deployed. The shared resources support all of their tenants and include a tenant map database, as shown in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/example-data-pipeline.png" alt="Diagram showing the workflow to deploy the shared resources by using a pipeline.">
</div>
</div>
<div class="paragraph">
<p>The Contoso team then builds a tenant onboarding API. When their sales team has completed the sale to a new customer, Microsoft Dynamics triggers the API to begin the onboarding process. Contoso also provides a self-service web interface for customers to use, and that triggers the API too.</p>
</div>
<div class="paragraph">
<p>The API asynchronously starts a workflow that onboards their new tenants. The workflow initiates the deployment of a new Azure SQL database, which might be done by one of the following approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Azure SDK to initiate the deployment of a second Bicep file that defines the Azure SQL database.</p>
</li>
<li>
<p>Use the Azure SDK to imperatively create an Azure SQL database, by using the <a href="https://docs.microsoft.com/en-us/dotnet/api/overview/azure/sql#management-library">management library</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the database is deployed, the workflow adds the tenant to the tenant list database, as shown in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/example-data-workflow.png" alt="example data workflow">
</div>
</div>
<div class="paragraph">
<p>Ongoing database schema updates are initiated by their application tier.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">Next steps</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Review the <a href="../considerations/updates.html">considerations for updating a multitenant solution</a>.</p>
</li>
<li>
<p>Consider <a href="storage-data.html">architectural approaches for storage and data</a>.</p>
</li>
<li>
<p>Consider <a href="https://docs.microsoft.com/en-us/azure/architecture/guide/multitenant/service/resource-manager">how to use Azure Resource Manager in a multitenant solution</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-22 13:10:08 UTC
</div>
</div>
</body>
</html>