<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Throttling pattern</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/darshandsoni/asciidoctor-skins/css/material-teal.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Throttling pattern</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_context_and_problem">Context and problem</a></li>
<li><a href="#_solution">Solution</a></li>
<li><a href="#_issues_and_considerations">Issues and considerations</a></li>
<li><a href="#_when_to_use_this_pattern">When to use this pattern</a></li>
<li><a href="#_example">Example</a></li>
<li><a href="#_next_steps">Next steps</a></li>
<li><a href="#_related_guidance">Related guidance</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">References</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589775(v=pandp.10)">Instrumentation and Telemetry Guidance</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589796(v=pandp.10)">Service Metering Guidance</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589774(v=pandp.10)">Autoscaling Guidance</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Control the consumption of resources used by an instance of an application, an individual tenant, or an entire service. This can allow the system to continue to function and meet service level agreements, even when an increase in demand places an extreme load on resources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context_and_problem">Context and problem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The load on a cloud application typically varies over time based on the number of active users or the types of activities they are performing. For example, more users are likely to be active during business hours, or the system might be required to perform computationally expensive analytics at the end of each month. There might also be sudden and unanticipated bursts in activity. If the processing requirements of the system exceed the capacity of the resources that are available, it&#8217;ll suffer from poor performance and can even fail. If the system has to meet an agreed level of service, such failure could be unacceptable.</p>
</div>
<div class="paragraph">
<p>There&#8217;re many strategies available for handling varying load in the cloud, depending on the business goals for the application. One strategy is to use autoscaling to match the provisioned resources to the user needs at any given time. This has the potential to consistently meet user demand, while optimizing running costs. However, while autoscaling can trigger the provisioning of additional resources, this provisioning isn&#8217;t immediate. If demand grows quickly, there can be a window of time where there&#8217;s a resource deficit.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An alternative strategy to autoscaling is to allow applications to use resources only up to a limit, and then throttle them when this limit is reached. The system should monitor how it&#8217;s using resources so that, when usage exceeds the threshold, it can throttle requests from one or more users. This will enable the system to continue functioning and meet any service level agreements (SLAs) that are in place. For more information on monitoring resource usage, see the <a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589775(v=pandp.10)">Instrumentation and Telemetry Guidance</a>.</p>
</div>
<div class="paragraph">
<p>The system could implement several throttling strategies, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rejecting requests from an individual user who&#8217;s already accessed system APIs more than n times per second over a given period of time. This requires the system to meter the use of resources for each tenant or user running an application. For more information, see the <a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589796(v=pandp.10)">Service Metering Guidance</a>.</p>
</li>
<li>
<p>Disabling or degrading the functionality of selected nonessential services so that essential services can run unimpeded with sufficient resources. For example, if the application is streaming video output, it could switch to a lower resolution.</p>
</li>
<li>
<p>Using load leveling to smooth the volume of activity (this approach is covered in more detail by the <a href="queue-based-load-leveling.html">Queue-based Load Leveling pattern</a>). In a multi-tenant environment, this approach will reduce the performance for every tenant. If the system must support a mix of tenants with different SLAs, the work for high-value tenants might be performed immediately. Requests for other tenants can be held back, and handled when the backlog has eased. The <a href="priority-queue.html">Priority Queue pattern</a> could be used to help implement this approach.</p>
</li>
<li>
<p>Deferring operations being performed on behalf of lower priority applications or tenants. These operations can be suspended or limited, with an exception generated to inform the tenant that the system is busy and that the operation should be retried later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The figure shows an area graph for resource use (a combination of memory, CPU, bandwidth, and other factors) against time for applications that are making use of three features. A feature is an area of functionality, such as a component that performs a specific set of tasks, a piece of code that performs a complex calculation, or an element that provides a service such as an in-memory cache. These features are labeled A, B, and C.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/throttling-resource-utilization.png" alt="throttling resource utilization">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The area immediately below the line for a feature indicates the resources that are used by applications when they invoke this feature. For example, the area below the line for Feature A shows the resources used by applications that are making use of Feature A, and the area between the lines for Feature A and Feature B indicates the resources used by applications invoking Feature B. Aggregating the areas for each feature shows the total resource use of the system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous figure illustrates the effects of deferring operations. Just prior to time T1, the total resources allocated to all applications using these features reach a threshold (the limit of resource use). At this point, the applications are in danger of exhausting the resources available. In this system, Feature B is less critical than Feature A or Feature C, so it&#8217;s temporarily disabled and the resources that it was using are released. Between times T1 and T2, the applications using Feature A and Feature C continue running as normal. Eventually, the resource use of these two features diminishes to the point when, at time T2, there is sufficient capacity to enable Feature B again.</p>
</div>
<div class="paragraph">
<p>The autoscaling and throttling approaches can also be combined to help keep the applications responsive and within SLAs. If the demand is expected to remain high, throttling provides a temporary solution while the system scales out. At this point, the full functionality of the system can be restored.</p>
</div>
<div class="paragraph">
<p>The next figure shows an area graph of the overall resource use by all applications running in a system against time, and illustrates how throttling can be combined with autoscaling.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/throttling-autoscaling.png" alt="throttling autoscaling">
</div>
</div>
<div class="paragraph">
<p>At time T1, the threshold specifying the soft limit of resource use is reached. At this point, the system can start to scale out. However, if the new resources don&#8217;t become available quickly enough, then the existing resources might be exhausted and the system could fail. To prevent this from occurring, the system is temporarily throttled, as described earlier. When autoscaling has completed and the additional resources are available, throttling can be relaxed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues_and_considerations">Issues and considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should consider the following points when deciding how to implement this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Throttling an application, and the strategy to use, is an architectural decision that impacts the entire design of a system. Throttling should be considered early in the application design process because it isn&#8217;t easy to add once a system has been implemented.</p>
</li>
<li>
<p>Throttling must be performed quickly. The system must be capable of detecting an increase in activity and react accordingly. The system must also be able to revert to its original state quickly after the load has eased. This requires that the appropriate performance data is continually captured and monitored.</p>
</li>
<li>
<p>If a service needs to temporarily deny a user request, it should return a specific error code so the client application understands that the reason for the refusal to perform an operation is due to throttling. The client application can wait for a period before retrying the request.</p>
</li>
<li>
<p>Throttling can be used as a temporary measure while a system autoscales. In some cases it&#8217;s better to simply throttle, rather than to scale, if a burst in activity is sudden and isn&#8217;t expected to be long lived because scaling can add considerably to running costs.</p>
</li>
<li>
<p>If throttling is being used as a temporary measure while a system autoscales, and if resource demands grow very quickly, the system might not be able to continue functioningâ€”even when operating in a throttled mode. If this isn&#8217;t acceptable, consider maintaining larger capacity reserves and configuring more aggressive autoscaling.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_to_use_this_pattern">When to use this pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To ensure that a system continues to meet service level agreements.</p>
</li>
<li>
<p>To prevent a single tenant from monopolizing the resources provided by an application.</p>
</li>
<li>
<p>To handle bursts in activity.</p>
</li>
<li>
<p>To help cost-optimize a system by limiting the maximum resource levels needed to keep it functioning.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The final figure illustrates how throttling can be implemented in a multi-tenant system. Users from each of the tenant organizations access a cloud-hosted application where they fill out and submit surveys. The application contains instrumentation that monitors the rate at which these users are submitting requests to the application.</p>
</div>
<div class="paragraph">
<p>In order to prevent the users from one tenant affecting the responsiveness and availability of the application for all other users, a limit is applied to the number of requests per second the users from any one tenant can submit. The application blocks requests that exceed this limit.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/throttling-multi-tenant.png" alt="throttling multi tenant">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following guidance may also be relevant when implementing this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589775(v=pandp.10)">Instrumentation and Telemetry Guidance</a>. Throttling depends on gathering information about how heavily a service is being used. Describes how to generate and capture custom monitoring information.</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589796(v=pandp.10)">Service Metering Guidance</a>. Describes how to meter the use of services in order to gain an understanding of how they are used. This information can be useful in determining how to throttle a service.</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589774(v=pandp.10)">Autoscaling Guidance</a>. Throttling can be used as an interim measure while a system autoscales, or to remove the need for a system to autoscale. Contains information on autoscaling strategies.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_related_guidance">Related guidance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following patterns may also be relevant when implementing this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="queue-based-load-leveling.html">Queue-based Load Leveling pattern</a>. Queue-based load leveling is a commonly used mechanism for implementing throttling. A queue can act as a buffer that helps to even out the rate at which requests sent by an application are delivered to a service.</p>
</li>
<li>
<p><a href="priority-queue.html">Priority Queue pattern</a>. A system can use priority queuing as part of its throttling strategy to maintain performance for critical or higher value applications, while reducing the performance of less important applications.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-22 13:10:08 UTC
</div>
</div>
</body>
</html>